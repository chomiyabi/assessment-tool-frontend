<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ºæ–­çµæœ - DX Webè¨ºæ–­</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="container">
            <h1 class="logo">Haru Automation</h1>
        </div>
    </header>
    
    <!-- ã‚µãƒ–ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <section class="sub-header">
        <div class="container">
            <h1 class="sub-header-title">æ¥­å‹™æ”¹å–„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«è¨ºæ–­çµæœ</h1>
        </div>
    </section>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main">
        <div class="container">
            <div class="result-content">
                
                <!-- è¨ºæ–­çµæœã‚µãƒãƒªãƒ¼ -->
                <div class="result-summary-section">
                    <p class="result-summary-text" id="resultSummary">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹æ–‡è¨€: è²´ç¤¾ã®AIæ´»ç”¨ã‚¹ã‚³ã‚¢ã¯ã€ŒXXXã€ã€æ¥­å‹™æ”¹å–„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã¯ã€ŒYYYã€ã¨ãªã‚Šã¾ã™ã€‚ -->
                        è¨ºæ–­çµæœã‚’è¨ˆç®—ä¸­...
                    </p>
                </div>
                
                <!-- æ¥­å‹™æ”¹å–„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->
                <div class="result-chart-section">
                    <h3 class="chart-title">æ¥­å‹™æ”¹å–„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã®è¨ºæ–­çµæœ</h3>
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- ãƒ¬ãƒ™ãƒ«è©³ç´°è§£èª¬ -->
                <div class="level-detail-section">
                    <div class="level-description" id="levelDescription">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹è©³ç´°è§£èª¬ -->
                        <p>è¨ºæ–­ãƒ¬ãƒ™ãƒ«ã®è©³ç´°è§£èª¬ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
                
                <!-- Haru Automationã‚µãƒ¼ãƒ“ã‚¹ç´¹ä»‹ã‚¨ãƒªã‚¢ -->
                <div class="service-introduction">
                    <h3 class="service-title">Haru Automation ã®ã”ç´¹ä»‹</h3>
                    <div class="service-description">
                        <p><strong>ç”ŸæˆAIã¨ã‚ã‚‰ã‚†ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’é€£æºã•ã›ã€"å³æˆæœãŒå‡ºã‚‹"è‡ªå‹•åŒ–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚</strong></p>
                        
                        <p>Haru Automationã¯ã€ChatGPTã‚„Geminiãªã©ã®ç”ŸæˆAIã¨ã€Zapierã‚„Difyã€PowerAutomateã¨ã„ã£ãŸå„ç¨®åŠ¹ç‡åŒ–ãƒ„ãƒ¼ãƒ«ã‚’æœ€é©ã«çµ„ã¿åˆã‚ã›ã€ãŠå®¢æ§˜å°‚ç”¨ã®æ¥­å‹™æ”¹å–„ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>
                        
                        <p>AIå˜ä½“ã§ã¯å®Ÿç¾ã§ããªã‹ã£ãŸã€è¤‡é›‘ãªæ¥­å‹™ã®è‡ªå‹•åŒ–ã‚„å“è³ªå‘ä¸Šã¾ã§ã€ä¸€æ°—é€šè²«ã§ã”æ”¯æ´ã€‚ã€Œé¢å€’ã€ã‚’ãªãã—ã€ä¼æ¥­ã®ã‚³ã‚¢æ¥­å‹™ã«é›†ä¸­ã§ãã‚‹ç’°å¢ƒã‚’å‰µã‚Šå‡ºã—ã¾ã™ã€‚</p>
                        
                        <p>é«˜é¡ãªåˆæœŸæŠ•è³‡ã¯ä¸è¦ã§ã™ã€‚ã¾ãšã¯<strong>29,800å††ã®ã€ŒãŠè©¦ã—ãƒ—ãƒ©ãƒ³ã€</strong>ã§ã€æ¥­å‹™ã®ä¸€ã¤ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’ä½“æ„Ÿã—ã¦ãã ã•ã„ã€‚åŠ¹æœã«ã”ç´å¾—ã„ãŸã ã‘ãŸä¸Šã§ã€æœ¬æ ¼çš„ãªã”æ”¯æ´ã¸ã¨ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒå¯èƒ½ã§ã™ã€‚</p>
                        
                        <p>å°å…¥å¾Œã®é‹ç”¨ã‚‚<strong>ã€Œä¸¸æŠ•ã’OKã€</strong>ã®ã‚µãƒãƒ¼ãƒˆä½“åˆ¶ã§ã€å®‰å¿ƒã—ã¦ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>
                    </div>
                    <div class="service-cta-buttons">
                        <button class="btn btn-primary" onclick="openServiceDetail()">
                            ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ã‚’è¦‹ã‚‹
                        </button>
                        <button class="btn btn-secondary" onclick="openContactForm()">
                            ãŠå•ã„åˆã‚ã›
                        </button>
                    </div>
                </div>
                <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ -->
                <div class="navigation-section">
                    <div class="navigation-buttons">
                        <button class="btn btn-outline" onclick="restartAssessment()">
                            è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Haru All Rights Reserved</p>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script src="js/common.js"></script>
    <script src="js/app.js"></script>
    <script src="js/api.js?v=4.2.0"></script>
    <script>
        // è¨ºæ–­çµæœãƒ‡ãƒ¼ã‚¿
        let resultData = {
            totalScore: 0,
            categoryScores: {},
            answers: {}
        };
        
        // ã‚«ãƒ†ã‚´ãƒªãƒãƒƒãƒ”ãƒ³ã‚°
        const categoryMapping = {
            'çµŒå–¶': { key: 'management', color: '#4A90E2' },
            'äººäº‹': { key: 'hr', color: '#EC892E' },
            'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°': { key: 'marketing', color: '#27AE60' },
            'å–¶æ¥­': { key: 'sales', color: '#8E44AD' },
            'IT': { key: 'it', color: '#E74C3C' },
            'Others': { key: 'others', color: '#9B59B6' },
            'ãã®ä»–': { key: 'others', color: '#9B59B6' }
        };
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('P-05: è¨ºæ–­çµæœãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
            const assessmentAnswers = Common.storage.get('assessmentAnswers');
            const userData = Common.storage.get('userData');
            
            if (!assessmentAnswers || !userData) {
                console.warn('è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¢ç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                // ãƒ‡ãƒ¢ç”¨ï¼šã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§å‡¦ç†ã‚’ç¶™ç¶šï¼ˆæœ¬ç•ªã§ã¯å‰Šé™¤æ¨å¥¨ï¼‰
                const sampleAnswers = { Q001: 2, Q002: 3, Q003: 1, Q004: 2, Q005: 3 };
                await calculateResults(sampleAnswers);
                displayResults();
                return;
            }
            
            // APIã‹ã‚‰çµæœã‚’å–å¾—ã™ã‚‹ã‹ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§è¨ˆç®—
            if (userData.session_id) {
                try {
                    LoadingHelper.show('å°‘ã€…ãŠå¾…ã¡ãã ã•ã„');
                    
                    const apiResult = await API.getResult(userData.session_id);
                    console.log('APIçµæœå–å¾—æˆåŠŸ:', apiResult);
                    
                    // APIçµæœã‚’ä½¿ç”¨
                    resultData.totalScore = apiResult.total_score;
                    resultData.maturityLevel = apiResult.maturity_level;
                    resultData.categoryScores = apiResult.category_scores || {};
                    resultData.recommendedServices = apiResult.recommended_services || [];
                    
                    // ã‚«ãƒ†ã‚´ãƒªã‚¹ã‚³ã‚¢ã‚’æ•´å½¢ï¼ˆAPIã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼‰
                    const categoryScoresTemp = {};
                    Object.keys(resultData.categoryScores).forEach(category => {
                        const score = resultData.categoryScores[category];
                        // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®è³ªå•æ•°ã‚’è¨ˆç®—ï¼ˆå®Ÿéš›ã®è³ªå•ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼‰
                        let categoryQuestionCount = 0;
                        if (apiResult.questions_by_category && apiResult.questions_by_category[category]) {
                            categoryQuestionCount = apiResult.questions_by_category[category];
                        } else {
                            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ¨å®šï¼ˆçµŒå–¶3å•ã€äººäº‹1å•ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°1å•ï¼‰
                            if (category === 'çµŒå–¶') categoryQuestionCount = 3;
                            else if (category === 'äººäº‹') categoryQuestionCount = 1;
                            else if (category === 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°') categoryQuestionCount = 1;
                            else categoryQuestionCount = 1;
                        }
                        
                        categoryScoresTemp[category] = {
                            average: score,
                            total: score,
                            count: categoryQuestionCount
                        };
                    });
                    resultData.categoryScores = categoryScoresTemp;
                    
                    LoadingHelper.hide();
                    displayResults();
                    
                } catch (error) {
                    LoadingHelper.hide();
                    console.error('APIçµæœå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«è¨ˆç®—
                    await calculateResults(assessmentAnswers);
                    displayResults();
                }
            } else {
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒãªã„å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«è¨ˆç®—
                await calculateResults(assessmentAnswers);
                displayResults();
            }
        });
        
        // çµæœè¨ˆç®—
        async function calculateResults(answers) {
            try {
                // APIã‹ã‚‰æ­£ç¢ºãªè³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const questionData = await API.getQuestions();
                const questions = questionData.questions;
                
                if (!questions || questions.length === 0) {
                    throw new Error('è³ªå•ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                resultData.answers = answers;
                resultData.categoryScores = {};
                
                // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆå®Ÿéš›ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
                questions.forEach(question => {
                    const answerIndex = answers[question.question_id];
                    if (answerIndex !== null && answerIndex !== undefined && answerIndex >= 0) {
                        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å®Ÿéš›ã®ã‚¹ã‚³ã‚¢å€¤ã‚’ä½¿ç”¨
                        let score = 0;
                        switch(answerIndex) {
                            case 0:
                                score = question.option_1_score || 0;
                                break;
                            case 1:
                                score = question.option_2_score || 0;
                                break;
                            case 2:
                                score = question.option_3_score || 0;
                                break;
                            case 3:
                                score = question.option_4_score || 0;
                                break;
                            default:
                                score = 0;
                        }
                        
                        const category = question.category;
                        
                        if (!resultData.categoryScores[category]) {
                            resultData.categoryScores[category] = {
                                total: 0,
                                count: 0,
                                questions: []
                            };
                        }
                        
                        resultData.categoryScores[category].total += score;
                        resultData.categoryScores[category].count += 1;
                        resultData.categoryScores[category].questions.push({
                            questionId: question.question_id,
                            score: score
                        });
                    }
                });
                
                // å„ã‚«ãƒ†ã‚´ãƒªã®å¹³å‡ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆå®Ÿéš›ã®ã‚¹ã‚³ã‚¢å€¤ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼‰
                Object.keys(resultData.categoryScores).forEach(category => {
                    const data = resultData.categoryScores[category];
                    data.average = data.total / data.count;
                });
                
                // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆå…¨ã‚¹ã‚³ã‚¢ã®åˆè¨ˆï¼‰
                let totalScore = 0;
                Object.values(resultData.categoryScores).forEach(categoryData => {
                    totalScore += categoryData.total;
                });
                resultData.totalScore = totalScore;
                
                console.log('ã‚¹ã‚³ã‚¢è¨ˆç®—å®Œäº†:', {
                    totalScore: resultData.totalScore,
                    categoryScores: resultData.categoryScores
                });
                
            } catch (error) {
                console.error('ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå›ºå®šå€¤ã‚’ä½¿ç”¨
                await calculateResultsFallback(answers);
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨è¨ˆç®—é–¢æ•°ï¼ˆAPIå¤±æ•—æ™‚ï¼‰
        async function calculateResultsFallback(answers) {
            console.warn('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç®—ã‚’ä½¿ç”¨ã—ã¾ã™');
            
            // ã‚µãƒ³ãƒ—ãƒ«è³ªå•ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨åŒã˜æ§‹é€ ï¼‰
            const sampleQuestions = [
                {
                    question_id: 'Q001',
                    category: 'çµŒå–¶',
                    question_text: 'è‡ªç¤¾ã®çµŒå–¶æˆ¦ç•¥ã«åˆã‚ã›ãŸDXæˆ¦ç•¥ã‚’ç­–å®šã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ ã¾ãŸã€æˆ¦ç•¥ã¯ç¤¾å†…ã«å…¬é–‹ã€å‘¨çŸ¥ã•ã‚Œã€çµ„ç¹”ã«èªçŸ¥ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ',
                    option_1_score: 1, option_2_score: 2, option_3_score: 3, option_4_score: 4
                },
                {
                    question_id: 'Q002',
                    category: 'çµŒå–¶',
                    question_text: 'å°†æ¥ã«ãŠã‘ã‚‹ãƒ‡ã‚£ã‚¹ãƒ©ãƒ—ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹å±æ©Ÿæ„Ÿã‚’ç¤¾å†…ã§å…±æœ‰ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ',
                    option_1_score: 1, option_2_score: 2, option_3_score: 3, option_4_score: 4
                },
                {
                    question_id: 'Q003',
                    category: 'çµŒå–¶',
                    question_text: 'DXæ¨é€²ã«å¯¾ã—ã¦äºˆç®—ãŒç¢ºä¿ã•ã‚Œã€ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®ã‚’è©•ä¾¡ã™ã‚‹ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
                    option_1_score: 1, option_2_score: 2, option_3_score: 3, option_4_score: 4
                },
                {
                    question_id: 'Q004',
                    category: 'äººäº‹',
                    question_text: 'ãƒ‡ã‚¸ã‚¿ãƒ«äººæã®æ¡ç”¨ãƒ»è‚²æˆã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿ',
                    option_1_score: 1, option_2_score: 2, option_3_score: 3, option_4_score: 4
                },
                {
                    question_id: 'Q005',
                    category: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°',
                    question_text: 'é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨ã—ãŸãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ–½ç­–ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ',
                    option_1_score: 1, option_2_score: 2, option_3_score: 3, option_4_score: 4
                }
            ];
            
            resultData.answers = answers;
            resultData.categoryScores = {};
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ã‚³ã‚¢è¨ˆç®—
            sampleQuestions.forEach(question => {
                const answerIndex = answers[question.question_id];
                if (answerIndex !== null && answerIndex !== undefined && answerIndex >= 0) {
                    let score = 0;
                    switch(answerIndex) {
                        case 0:
                            score = question.option_1_score;
                            break;
                        case 1:
                            score = question.option_2_score;
                            break;
                        case 2:
                            score = question.option_3_score;
                            break;
                        case 3:
                            score = question.option_4_score;
                            break;
                        default:
                            score = 0;
                    }
                    
                    const category = question.category;
                    
                    if (!resultData.categoryScores[category]) {
                        resultData.categoryScores[category] = {
                            total: 0,
                            count: 0,
                            questions: []
                        };
                    }
                    
                    resultData.categoryScores[category].total += score;
                    resultData.categoryScores[category].count += 1;
                    resultData.categoryScores[category].questions.push({
                        questionId: question.question_id,
                        score: score
                    });
                }
            });
            
            // å„ã‚«ãƒ†ã‚´ãƒªã®å¹³å‡ã‚¹ã‚³ã‚¢è¨ˆç®—
            Object.keys(resultData.categoryScores).forEach(category => {
                const data = resultData.categoryScores[category];
                data.average = data.total / data.count;
            });
            
            // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆå…¨ã‚¹ã‚³ã‚¢ã®åˆè¨ˆï¼‰
            let totalScore = 0;
            Object.values(resultData.categoryScores).forEach(categoryData => {
                totalScore += categoryData.total;
            });
            resultData.totalScore = totalScore;
        }
        
        // çµæœè¡¨ç¤º
        function displayResults() {
            console.log('çµæœè¡¨ç¤ºé–‹å§‹');
            console.log('ç¾åœ¨ã®resultData:', resultData);
            
            // ç·åˆã‚¹ã‚³ã‚¢è¡¨ç¤ºï¼ˆå‰Šé™¤æ¸ˆã¿ï¼‰
            // document.getElementById('totalScore').textContent = resultData.totalScore;
            
            // æ–°è¦: ãƒ¬ãƒ™ãƒ«åˆ¤å®šã¨è¡¨ç¤º
            // æœ¬ç•ªç”¨ï¼šãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (!resultData.totalScore && resultData.totalScore !== 0) {
                console.warn('totalScoreãŒæœªè¨­å®šã®ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ã‚¢ã‚’ä½¿ç”¨ã—ã¾ã™');
                resultData.totalScore = 0; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ã‚¢ï¼ˆãƒ¬ãƒ™ãƒ«1ï¼‰
            }
            
            const levelInfo = determineMaturityLevel(resultData.totalScore);
            const summaryText = generateSummaryText(resultData.totalScore, levelInfo.name);
            const descriptionText = getLevelDescription(levelInfo.level);
            
            console.log('ãƒ¬ãƒ™ãƒ«åˆ¤å®šçµæœ:', levelInfo);
            console.log('ã‚µãƒãƒªãƒ¼æ–‡:', summaryText);
            console.log('è§£èª¬æ–‡:', descriptionText.substring(0, 100) + '...');
            
            // DOMæ›´æ–°
            const summaryElement = document.getElementById('resultSummary');
            const descriptionElement = document.getElementById('levelDescription');
            
            if (summaryElement) {
                summaryElement.textContent = summaryText;
            } else {
                console.error('resultSummaryè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            if (descriptionElement) {
                // è¤‡æ•°æ®µè½ã«åˆ†å‰²ã—ã¦è¡¨ç¤º
                descriptionElement.innerHTML = '';
                const paragraphs = descriptionText.split('\n\n');
                paragraphs.forEach(paragraph => {
                    if (paragraph.trim()) {
                        const p = document.createElement('p');
                        p.textContent = paragraph.trim();
                        p.style.marginBottom = '16px';
                        descriptionElement.appendChild(p);
                    }
                });
            } else {
                console.error('levelDescriptionè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå‰Šé™¤æ¸ˆã¿ï¼‰
            // generateScoreCards();
            
            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆ
            generateRadarChart();
        }
        
        // ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå‰Šé™¤æ¸ˆã¿ï¼‰
        /*
        function generateScoreCards() {
            const container = document.getElementById('scoreCards');
            container.innerHTML = '';
            
            Object.keys(resultData.categoryScores).forEach(category => {
                const data = resultData.categoryScores[category];
                const mapping = categoryMapping[category] || { key: 'other', color: '#666' };
                
                const card = document.createElement('div');
                card.className = 'score-card';
                card.innerHTML = `
                    <div class="score-card-header">
                        <h4 class="score-card-title">${category}</h4>
                        <div class="score-card-value" style="color: ${mapping.color}">
                            ${Math.round(data.average)}<span class="score-unit">ç‚¹</span>
                        </div>
                    </div>
                    <div class="score-card-progress">
                        <div class="score-progress-bar">
                            <div class="score-progress-fill" style="width: ${data.average}%; background-color: ${mapping.color}"></div>
                        </div>
                    </div>
                    <div class="score-card-details">
                        <span class="score-questions">${data.count}å•å›ç­”</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        */
        
        // ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚¹ã‚³ã‚¢å€¤ã«åŸºã¥ãï¼‰
        function determineMaturityLevel(totalScore) {
            // å®Ÿéš›ã®ã‚¹ã‚³ã‚¢ç¯„å›²ã«åŸºã¥ã„ãŸãƒ¬ãƒ™ãƒ«åˆ¤å®š
            // 5å•Ã—æœ€å¤§4ç‚¹ = æœ€å¤§20ç‚¹ã‚’æƒ³å®šï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å®Ÿéš›ã®å€¤ã«ã‚ˆã‚‹ï¼‰
            if (totalScore <= 8) return { level: 1, name: 'æ¥­å‹™æ”¹å–„ é»æ˜æœŸ' };
            if (totalScore <= 13) return { level: 2, name: 'æ¥­å‹™æ”¹å–„ è©¦è¡ŒæœŸ' };
            if (totalScore <= 17) return { level: 3, name: 'æ¥­å‹™æ”¹å–„ å±•é–‹æœŸ' };
            return { level: 4, name: 'æ¥­å‹™æ”¹å–„ å…ˆé€²æœŸ' };
        }
        
        // ãƒ¬ãƒ™ãƒ«åˆ¥è§£èª¬æ–‡å–å¾—
        function getLevelDescription(level) {
            const descriptions = {
                1: `AIã‚„ITãƒ„ãƒ¼ãƒ«ã®æ´»ç”¨ã¯ã¾ã æœ¬æ ¼çš„ã«å§‹ã¾ã£ã¦ã„ãªã„ã€ã‚‚ã—ãã¯æ¤œè¨æ®µéšã«ã‚ã‚Šã¾ã™ã€‚
æƒ…å ±åé›†ã‚„ãƒ„ãƒ¼ãƒ«ã®çŸ¥è­˜ã€å…·ä½“çš„ãªæ´»ç”¨ã‚¢ã‚¤ãƒ‡ã‚¢ãŒå…¨ä½“çš„ã«ä¸è¶³ã—ã¦ãŠã‚Šã€å€‹äººã®é–¢å¿ƒã‚„åŠªåŠ›ã«ä¾å­˜ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚è¦‹æ–¹ã‚’å¤‰ãˆã‚Œã°ã€ã“ã‚Œã‹ã‚‰å¤§ããæˆé•·ã§ãã‚‹éå¸¸ã«é«˜ã„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’ç§˜ã‚ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚

ã¾ãšã¯çµŒå–¶å±¤ã‚’å«ã‚ã€AIã‚„ITãƒ„ãƒ¼ãƒ«ãŒã‚‚ãŸã‚‰ã™æ¥­å‹™æ”¹å–„ã®å¯èƒ½æ€§ã«ã¤ã„ã¦å…±é€šèªè­˜ã‚’æŒã¤ã“ã¨ãŒç¬¬ä¸€æ­©ã§ã™ã€‚ä»–ç¤¾ã®æˆåŠŸäº‹ä¾‹ã‚’å­¦ã¶ã€å°è¦æ¨¡ãªã‚»ãƒŸãƒŠãƒ¼ã«å‚åŠ ã™ã‚‹ãªã©ã€æƒ…å ±åé›†ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚ãã—ã¦ã€ç‰¹å®šã®éåŠ¹ç‡ãªæ¥­å‹™ã‚’ä¸€ã¤é¸ã³ã€ãƒ„ãƒ¼ãƒ«ã®è©¦é¨“çš„ãªå°å…¥ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`,
                
                2: `AIã‚„ITãƒ„ãƒ¼ãƒ«ã¸ã®é–¢å¿ƒã¯é«˜ãã€ä¸€éƒ¨ã®éƒ¨ç½²ã‚„æ„æ¬²çš„ãªå€‹äººã«ã‚ˆã£ã¦ãƒ„ãƒ¼ãƒ«ã®å°å…¥ã‚„æ´»ç”¨ãŒå§‹ã¾ã£ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ãã®å–ã‚Šçµ„ã¿ã¯ã¾ã é™å®šçš„ãƒ»æ•£ç™ºçš„ã§ã‚ã‚Šã€å…¨ç¤¾çš„ãªå‹•ãã«ã¯è‡³ã£ã¦ã„ã¾ã›ã‚“ã€‚å°ã•ãªæˆåŠŸä½“é¨“ã¨ã€ã†ã¾ãã„ã‹ãªã‹ã£ãŸçµŒé¨“ãŒæ··åœ¨ã—ã¦ã„ã‚‹æ®µéšã§ã™ã€‚

å€‹åˆ¥ã®æˆåŠŸäº‹ä¾‹ã‚’ç¤¾å†…ã§å…±æœ‰ã—ã€æ¨ªå±•é–‹ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚æ¥­å‹™æ”¹å–„ã‚„DXã‚’æ¨é€²ã™ã‚‹æ‹…å½“è€…ã‚’æ­£å¼ã«ä»»å‘½ã—ã€ã‚ˆã‚Šä½“ç³»çš„ãªæƒ…å ±åé›†ã‚„ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã®æ©Ÿä¼šï¼ˆç ”ä¿®ãªã©ï¼‰ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒæœ‰åŠ¹ã§ã™ã€‚å¤–éƒ¨ã®å°‚é–€å®¶ã®çŸ¥è¦‹ã‚‚æ´»ç”¨ã—ã€å…·ä½“çš„ãªæ¥­å‹™æ”¹å–„è¨ˆç”»ã®ç­–å®šã«ç€æ‰‹ã™ã‚‹ã®ã«æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚`,
                
                3: `è¤‡æ•°ã®éƒ¨ç½²ã§AIã‚„ITãƒ„ãƒ¼ãƒ«ã®æ´»ç”¨ãŒå®šç€ã—ã€æ¥­å‹™æ”¹å–„ã®æˆåŠŸäº‹ä¾‹ã‚‚å¢—ãˆã¦ã„ã¾ã™ã€‚DXæ¨é€²ã®æ‹…å½“è€…ã‚„ãƒãƒ¼ãƒ ãŒå­˜åœ¨ã—ã€çµ„ç¹”çš„ãªå–ã‚Šçµ„ã¿ã¨ã—ã¦æ´»å‹•ãŒé€²ã‚“ã§ã„ã¾ã™ã€‚ä¸€æ–¹ã§ã€éƒ¨ç½²ã”ã¨ã«å°å…¥ã—ãŸãƒ„ãƒ¼ãƒ«ãŒç•°ãªã£ãŸã‚Šã€éƒ¨åˆ†çš„ãªæœ€é©åŒ–ã«ç•™ã¾ã£ã¦ã„ãŸã‚Šã¨ã€å…¨ç¤¾çš„ãªæˆ¦ç•¥ã‚„é€£æºã«ã¯ã¾ã æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚‹çŠ¶æ…‹ã§ã™ã€‚

éƒ¨ç½²ã”ã¨ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹ã‚„ãƒ„ãƒ¼ãƒ«ã‚’è¦‹ç›´ã—ã€å…¨ç¤¾çš„ãªè¦–ç‚¹ã§ã®æ¨™æº–åŒ–ã‚„ãƒ‡ãƒ¼ã‚¿é€£æºã‚’æ¨é€²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å°‚é–€éƒ¨ç½²ãŒä¸»å°ã—ã¦å…¨ç¤¾çš„ãªDXæˆ¦ç•¥ã‚’ç­–å®šãƒ»å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå¤§ããªæˆæœãŒæœŸå¾…ã§ãã¾ã™ã€‚å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ´»ç”¨ã—ã€é«˜åº¦ãªãƒ„ãƒ¼ãƒ«é€£æºã‚„æ¥­å‹™è‡ªå‹•åŒ–ã‚’å®Ÿç¾ã™ã‚‹ã®ã‚‚åŠ¹æœçš„ã§ã™ã€‚`,
                
                4: `çµŒå–¶å±¤ã®å¼·ã„ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆã®ã‚‚ã¨ã€å…¨ç¤¾çš„ã«AIã‚„ITãƒ„ãƒ¼ãƒ«ãŒæ´»ç”¨ã•ã‚Œã€æ¥­å‹™æ”¹å–„ãŒæ–‡åŒ–ã¨ã—ã¦æ ¹ä»˜ã„ã¦ã„ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæ„æ€æ±ºå®šãŒæµ¸é€ã—ã€ç¶™ç¶šçš„ãªæ”¹å–„ã‚µã‚¤ã‚¯ãƒ«ãŒç¢ºç«‹ã•ã‚Œã¦ã„ã¾ã™ã€‚å¸‚å ´ã®å¤‰åŒ–ã«ã‚‚è¿…é€Ÿã«å¯¾å¿œã§ãã‚‹ã€éå¸¸ã«ç«¶äº‰åŠ›ã®é«˜ã„çµ„ç¹”çŠ¶æ…‹ã§ã™ã€‚

ã“ã‚Œã¾ã§ã®æˆåŠŸã‚’ç¶™ç¶šã—ã¤ã¤ã€AIãŒè‡ªå¾‹çš„ã«æ¥­å‹™ã‚’è¡Œã†ã€ŒAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ã‚„ã€è‡ªç¤¾ã®æ¥­å‹™ã«ç‰¹åŒ–ã—ãŸAIãƒ¢ãƒ‡ãƒ«ã®é–‹ç™ºï¼ˆãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰ãªã©ã€ã‚ˆã‚Šå…ˆé€²çš„ãªæŠ€è¡“ã®å°å…¥ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚æ¥­ç•Œã®ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦ã€AIã‚’æ´»ç”¨ã—ãŸæ–°ãŸãªãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã®å‰µå‡ºã‚„ã€ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³å…¨ä½“ã®å¤‰é©ã‚’ä¸»å°ã—ã¦ã„ãã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚`
            };
            return descriptions[level] || 'è©²å½“ã™ã‚‹ãƒ¬ãƒ™ãƒ«ã®è§£èª¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚';
        }
        
        // ã‚µãƒãƒªãƒ¼æ–‡ç”Ÿæˆ
        function generateSummaryText(totalScore, levelName) {
            return `è²´ç¤¾ã®AIæ´»ç”¨ã‚¹ã‚³ã‚¢ã¯ã€Œ${totalScore}ã€ã€æ¥­å‹™æ”¹å–„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã¯ã€Œ${levelName}ã€ã¨ãªã‚Šã¾ã™ã€‚`;
        }
        
        // ãƒ†ã‚¹ãƒˆé–¢æ•°ï¼ˆæ›´æ–°ã•ã‚ŒãŸã‚¹ã‚³ã‚¢ç¯„å›²ç”¨ï¼‰
        function testLevelLogic() {
            console.log('=== ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            // å„ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆæ›´æ–°ã•ã‚ŒãŸã‚¹ã‚³ã‚¢ç¯„å›²ï¼‰
            const testCases = [
                { score: 5, expected: 'ãƒ¬ãƒ™ãƒ«1' },
                { score: 10, expected: 'ãƒ¬ãƒ™ãƒ«2' }, 
                { score: 15, expected: 'ãƒ¬ãƒ™ãƒ«3' },
                { score: 18, expected: 'ãƒ¬ãƒ™ãƒ«4' }
            ];
            
            testCases.forEach(testCase => {
                const result = determineMaturityLevel(testCase.score);
                const summary = generateSummaryText(testCase.score, result.name);
                const description = getLevelDescription(result.level);
                
                console.log(`\nã‚¹ã‚³ã‚¢: ${testCase.score} (${testCase.expected})`);
                console.log(`çµæœ: ãƒ¬ãƒ™ãƒ«${result.level} - ${result.name}`);
                console.log(`ã‚µãƒãƒªãƒ¼: ${summary}`);
                console.log(`è§£èª¬: ${description.substring(0, 100)}...`);
            });
            
            console.log('=== ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ†ã‚¹ãƒˆå®Œäº† ===');
        }
        
        // Step 9: çµ±åˆãƒ†ã‚¹ãƒˆç”¨é–¢æ•°ï¼ˆæ›´æ–°ã•ã‚ŒãŸã‚¹ã‚³ã‚¢ç¯„å›²ï¼‰
        function runIntegrationTests() {
            console.log('ğŸ§ª === çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            // Test Case 1-4: å„ãƒ¬ãƒ™ãƒ«ã§ã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆï¼ˆæ›´æ–°ã•ã‚ŒãŸã‚¹ã‚³ã‚¢ç¯„å›²ï¼‰
            const testCases = [
                { level: 1, score: 5, name: 'ãƒ¬ãƒ™ãƒ«1ï¼ˆæ¥­å‹™æ”¹å–„ é»æ˜æœŸï¼‰' },
                { level: 2, score: 10, name: 'ãƒ¬ãƒ™ãƒ«2ï¼ˆæ¥­å‹™æ”¹å–„ è©¦è¡ŒæœŸï¼‰' },
                { level: 3, score: 15, name: 'ãƒ¬ãƒ™ãƒ«3ï¼ˆæ¥­å‹™æ”¹å–„ å±•é–‹æœŸï¼‰' },
                { level: 4, score: 18, name: 'ãƒ¬ãƒ™ãƒ«4ï¼ˆæ¥­å‹™æ”¹å–„ å…ˆé€²æœŸï¼‰' }
            ];
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    console.log(`\nğŸ” ${testCase.name}ãƒ†ã‚¹ãƒˆé–‹å§‹`);
                    
                    // ã‚¹ã‚³ã‚¢ã‚’è¨­å®š
                    resultData.totalScore = testCase.score;
                    
                    // ãƒ¬ãƒ™ãƒ«åˆ¤å®šå®Ÿè¡Œ
                    const levelInfo = determineMaturityLevel(testCase.score);
                    const summaryText = generateSummaryText(testCase.score, levelInfo.name);
                    const descriptionText = getLevelDescription(levelInfo.level);
                    
                    // DOMæ›´æ–°
                    const summaryElement = document.getElementById('resultSummary');
                    const descriptionElement = document.getElementById('levelDescription');
                    
                    if (summaryElement) {
                        summaryElement.textContent = summaryText;
                    }
                    
                    if (descriptionElement) {
                        descriptionElement.innerHTML = '';
                        const paragraphs = descriptionText.split('\n\n');
                        paragraphs.forEach(paragraph => {
                            if (paragraph.trim()) {
                                const p = document.createElement('p');
                                p.textContent = paragraph.trim();
                                p.style.marginBottom = '16px';
                                descriptionElement.appendChild(p);
                            }
                        });
                    }
                    
                    console.log(`âœ… ${testCase.name}: è¡¨ç¤ºæ›´æ–°å®Œäº†`);
                    console.log(`   ã‚¹ã‚³ã‚¢: ${testCase.score}`);
                    console.log(`   ãƒ¬ãƒ™ãƒ«: ${levelInfo.level} - ${levelInfo.name}`);
                    
                    if (index === testCases.length - 1) {
                        setTimeout(() => {
                            console.log('\nğŸ‰ ã™ã¹ã¦ã®ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆå®Œäº†');
                            console.log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºç¢ºèª: F12 > ãƒ‡ãƒã‚¤ã‚¹ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã§ãƒ†ã‚¹ãƒˆ');
                            console.log('ğŸ–±ï¸  ãƒœã‚¿ãƒ³å‹•ä½œç¢ºèª: å„ç¨®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆ');
                        }, 1000);
                    }
                }, index * 3000); // 3ç§’é–“éš”ã§å®Ÿè¡Œ
            });
        }
        
        // ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
        function testErrorCases() {
            console.log('âŒ === ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            // ç„¡åŠ¹ãªã‚¹ã‚³ã‚¢ã§ã®ãƒ†ã‚¹ãƒˆï¼ˆæ›´æ–°ã•ã‚ŒãŸã‚¹ã‚³ã‚¢ç¯„å›²ï¼‰
            console.log('ğŸ” å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ');
            [-1, 0, 8, 9, 13, 14, 17, 18, 20, 25].forEach(score => {
                const levelInfo = determineMaturityLevel(score);
                console.log(`ã‚¹ã‚³ã‚¢${score}: ãƒ¬ãƒ™ãƒ«${levelInfo.level} - ${levelInfo.name}`);
            });
            
            // DOMè¦ç´ ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
            console.log('ğŸ” DOMè¦ç´ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ');
            const originalSummary = document.getElementById('resultSummary');
            const originalDescription = document.getElementById('levelDescription');
            
            // ä¸€æ™‚çš„ã«è¦ç´ ã‚’ç„¡åŠ¹åŒ–
            if (originalSummary) originalSummary.id = 'temp-summary';
            if (originalDescription) originalDescription.id = 'temp-description';
            
            try {
                displayResults();
                console.log('âœ… DOMè¦ç´ ä¸åœ¨æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ­£å¸¸');
            } catch (error) {
                console.error('âŒ DOMè¦ç´ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¤±æ•—:', error);
            }
            
            // è¦ç´ ã‚’å¾©å…ƒ
            if (originalSummary) originalSummary.id = 'resultSummary';
            if (originalDescription) originalDescription.id = 'levelDescription';
            
            console.log('âœ… ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†');
        }
        
        // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆ
        function generateRadarChart() {
            console.log('ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆé–‹å§‹');
            console.log('resultData.categoryScores:', resultData.categoryScores);
            
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            if (!resultData.categoryScores || Object.keys(resultData.categoryScores).length === 0) {
                console.error('ã‚«ãƒ†ã‚´ãƒªã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“');
                return;
            }
            
            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿æº–å‚™
            let labels = Object.keys(resultData.categoryScores);
            let data = labels.map(category => {
                const score = resultData.categoryScores[category];
                // å®Ÿéš›ã®ã‚¹ã‚³ã‚¢å€¤ã‚’ä½¿ç”¨ï¼ˆ0-100ã‚¹ã‚±ãƒ¼ãƒ«ã«æ­£è¦åŒ–ï¼‰
                if (typeof score === 'object') {
                    // æœ€å¤§å€¤ã‚’4ã¨ã—ã¦æ­£è¦åŒ–ï¼ˆé€šå¸¸ã¯è³ªå•ã”ã¨ã«1-4ç‚¹ï¼‰
                    return Math.min(100, (score.average / 4) * 100);
                } else {
                    return Math.min(100, (score / 4) * 100);
                }
            });
            
            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºã®ãŸã‚ã€æœ€ä½3è»¸å¿…è¦ãªå ´åˆã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
            if (labels.length < 3) {
                console.log('ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºã®ãŸã‚ã€ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ');
                const dummyCategories = ['äººäº‹', 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', 'å–¶æ¥­', 'IT'];
                const availableDummies = dummyCategories.filter(cat => !labels.includes(cat));
                
                while (labels.length < 5 && availableDummies.length > 0) {
                    const dummyCat = availableDummies.shift();
                    labels.push(dummyCat);
                    data.push(0); // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯0ç‚¹
                }
            }
            
            console.log('ãƒãƒ£ãƒ¼ãƒˆãƒ©ãƒ™ãƒ«ï¼ˆèª¿æ•´å¾Œï¼‰:', labels);
            console.log('ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆèª¿æ•´å¾Œï¼‰:', data);
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç¾åœ¨ã®ã‚¹ã‚³ã‚¢',
                        data: data,
                        backgroundColor: 'rgba(74, 144, 226, 0.2)',
                        borderColor: 'rgba(74, 144, 226, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(74, 144, 226, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(74, 144, 226, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true,
                                color: '#ddd'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: 12
                                }
                            },
                            pointLabels: {
                                font: {
                                    size: 24,
                                    weight: 'bold'
                                },
                                color: '#333'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ã‚’é–‹ã
        function openServiceDetail() {
            alert('Haru Automationã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ãƒšãƒ¼ã‚¸ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™ã€‚\nç¾åœ¨ã¯æ¦‚è¦ã‚’ã”è¦§ã„ãŸã ã‘ã¾ã™ã€‚');
        }
        
        // ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ é–‹ã
        function openContactForm() {
            alert('ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã¯ Phase 4 ã§å®Ÿè£…äºˆå®šã§ã™');
        }
        
        // çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadResults() {
            const userData = Common.storage.get('userData');
            const resultSummary = {
                company: userData.company,
                name: `${userData.lastName} ${userData.firstName}`,
                totalScore: resultData.totalScore,
                categoryScores: resultData.categoryScores,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(resultSummary, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dx-assessment-result-${userData.company}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            Common.ui.showAlert('è¨ºæ–­çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
        }
        
        // ã‚¹ã‚³ã‚¢è¨ˆç®—ã®ãƒ‡ãƒãƒƒã‚°é–¢æ•°
        async function debugScoreCalculation(testAnswers) {
            console.log('ğŸ” === ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ‡ãƒãƒƒã‚°é–‹å§‹ ===');
            console.log('ãƒ†ã‚¹ãƒˆç”¨å›ç­”ãƒ‡ãƒ¼ã‚¿:', testAnswers);
            
            try {
                // APIã‹ã‚‰è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ†ã‚¹ãƒˆ
                console.log('1. APIçµŒç”±ã§ã®ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ†ã‚¹ãƒˆ:');
                await calculateResults(testAnswers);
                
                console.log('è¨ˆç®—çµæœ:');
                console.log('- ç·åˆã‚¹ã‚³ã‚¢:', resultData.totalScore);
                console.log('- ã‚«ãƒ†ã‚´ãƒªã‚¹ã‚³ã‚¢:', resultData.categoryScores);
                
                // å„è³ªå•ã®è©³ç´°ãªã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’ç¢ºèª
                const questionData = await API.getQuestions();
                const questions = questionData.questions;
                
                let totalScoreCheck = 0;
                console.log('\n2. å„è³ªå•ã®ã‚¹ã‚³ã‚¢è©³ç´°:');
                questions.forEach(question => {
                    const answerIndex = testAnswers[question.question_id];
                    if (answerIndex !== null && answerIndex !== undefined && answerIndex >= 0) {
                        let score = 0;
                        switch(answerIndex) {
                            case 0: score = question.option_1_score || 0; break;
                            case 1: score = question.option_2_score || 0; break;
                            case 2: score = question.option_3_score || 0; break;
                            case 3: score = question.option_4_score || 0; break;
                        }
                        totalScoreCheck += score;
                        console.log(`- ${question.question_id}: å›ç­”${answerIndex + 1} â†’ ${score}ç‚¹`);
                    }
                });
                
                console.log('\n3. æ¤œç®—çµæœ:');
                console.log('- æ‰‹å‹•è¨ˆç®—åˆè¨ˆ:', totalScoreCheck);
                console.log('- ã‚·ã‚¹ãƒ†ãƒ è¨ˆç®—:', resultData.totalScore);
                console.log('- ä¸€è‡´:', totalScoreCheck === resultData.totalScore ? 'âœ…' : 'âŒ');
                
                // ãƒ¬ãƒ™ãƒ«åˆ¤å®šç¢ºèª
                const levelInfo = determineMaturityLevel(resultData.totalScore);
                console.log('\n4. ãƒ¬ãƒ™ãƒ«åˆ¤å®š:');
                console.log(`- ã‚¹ã‚³ã‚¢ ${resultData.totalScore} â†’ ${levelInfo.name}`);
                
                displayResults();
                
            } catch (error) {
                console.error('ãƒ‡ãƒãƒƒã‚°è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç®—ã§ãƒ†ã‚¹ãƒˆ:');
                await calculateResultsFallback(testAnswers);
                displayResults();
            }
            
            console.log('ğŸ” === ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ‡ãƒãƒƒã‚°å®Œäº† ===');
        }
        
        // è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™ï¼ˆStep 7æ”¹è‰¯ç‰ˆï¼‰
        function restartAssessment() {
            if (confirm('è¨ºæ–­ã‚’æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ\nç¾åœ¨ã®çµæœã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                try {
                    console.log('è¨ºæ–­ã‚„ã‚Šç›´ã—å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™');
                    
                    // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                    if (Common && Common.storage) {
                        Common.storage.clear();
                        console.log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç›´æ¥localStorageæ“ä½œ
                        localStorage.clear();
                        sessionStorage.clear();
                        console.log('ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç›´æ¥ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
                    }
                    
                    // ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸é·ç§»
                    if (Common && Common.navigation) {
                        Common.navigation.goToPage('index.html');
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç›´æ¥é·ç§»
                        window.location.href = 'index.html';
                    }
                    
                } catch (error) {
                    console.error('è¨ºæ–­ã‚„ã‚Šç›´ã—å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:', error);
                    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ‰‹å‹•ã§ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
                }
            }
        }
    </script>
</body>
</html>